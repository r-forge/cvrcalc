{
    "contents" : "## CVRCALC: A Cardiovascular Risk's Calculator by Scores\n## Developers: Maria Teresa Seoane Pillado & Miguel Angel Rodriguez Muinos\n## Contact: mail [at] leugimsan.es\n## From: A Coruna, Spain\n## Version: 1.0\n## creation Date: 2013/02/13\n## Last Version Date: 2013/08/08\n\n# require(XLConnect)\n# require(gWidgets)\n# options(guiToolkit=\"tcltk\")\n# require(gWidgetstcltk)\n\ncvrcalc_gui=function()\n{\n  options(guiToolkit=\"tcltk\")\n  modelos=c(\"Please, Select a model...\", \n            \"Dorica\", \n            \"Classic Framingham\",\n            \"Framingham-Wilson\",\n            \"Regicor\",\n            \"High Risk Score\",\n            \"Low Risk Score\")\n  \n  win=gwindow(\"CVR-CALC\")\n  group=ggroup(horizontal=FALSE, container=win)\n  texto=glabel(\"A Cardiovascular Risk Calculator using estimation by Scores\", container=group, font.attr=list(style=\"bold\"))\n  addSpring(group)\n  addSpace(group,15)\n  modelo=gcombobox(modelos, container=group)\n  addSpring(group)\n  boton=gbutton(\"Run\", container=group, \n                handler=function(h,...)\n                {eleccion=svalue(modelo)\n                 print(eleccion)\n                 if (eleccion==modelos[2]) \n                   dorica()\n                 else\n                   if (eleccion==modelos[3]) \n                     framingham_c()\n                 else\n                   if (eleccion==modelos[4]) \n                     framingham_w()\n                 else\n                   if (eleccion==modelos[5]) \n                     regicor()\n                 else\n                   if (eleccion==modelos[6]) \n                     hrs()\n                 else\n                   if (eleccion==modelos[7]) \n                     lrs()\n                 else\n                   print(\"Please, Select a model.\")\n                }\n  )\n}\n\n\ndorica=function()\n{\n###########################################################################\n## DORICA (FRAMINGHAM, SPAIN CALIBRATED). Programmed, no tables\n## ref: Aranceta J, Perez Rodrigo C, Foz Sala M, Mantilla T, Serra Majem L, \n## Moreno B, Monereo S, Millan J; \n## Grupo Colaborativo para el estudio DORICA fase 2.\n## [Tables of coronary risk evaluation adapted to the Spanish population: \n## the DORICA study]\n## Med Clin (Barc). 2004 Nov 20;123(18):686-91. Spanish. \n## Erratum in: Med Clin\n## (Barc). 2004 Dec 4;123(20):30. PubMed PMID: 15563815\n###########################################################################\n  \nfile.import=gfile(\"Please, Select the Excel file with the DATA to import...\",filter=\"*.*\")\nwb.datos=loadWorkbook(file.import, create=FALSE)\nmisdatos.full=readWorksheet(wb.datos, sheet=1)\nmisdatos=na.omit(misdatos.full)\ncoloca_reg=data.frame(row.names(misdatos))\nnum_regs=dim(misdatos)[1]\nresultados=0\nregistro=1\nfor (registro in 1:num_regs)\n{\n  sexo=misdatos[registro,1]\n  edad=misdatos[registro,2]\n  colesterol=misdatos[registro,3]\n  hdl=misdatos[registro,4]\n  tas=misdatos[registro,5]\n  tad=misdatos[registro,6]\n  fuma=misdatos[registro,7]\n  diabetes=misdatos[registro,8]\n  hipertrofia=misdatos[registro,9]\n  \n  if (colesterol<160)col1<-1 else col1<-0\n  if (colesterol>=160 & colesterol<200)col2<-1 else col2<-0 \n  if (colesterol>=200& colesterol<240)col3<-1 else col3<-0 \n  if (colesterol>=240 & colesterol<280)col4<-1 else col4<-0 \n  if (colesterol>=280)col5<-1 else col5<-0 \n  \n  if (hdl<35)hdl1<-1 else hdl1<-0\n  if (hdl>=35 & hdl<45)hdl2<-1 else hdl2<-0 \n  if (hdl>=45 & hdl<50)hdl3<-1 else hdl3<-0 \n  if (hdl>=50 & hdl<60)hdl4<-1 else hdl4<-0 \n  if (hdl>=60)hdl5<-1 else hdl5<-0 \n\n  t1<-0\n  t2<-0\n  t3<-0\n  t4<-0\n  t5<-0\n\n  if (tas<120  & tad<80)t1<-1 else t1<-0\n\n  if (tas<120){\n  if (tad>=80 & tad<85) \n  t2<-1 else t2<-0\n  if (tad>=85 & tad<90) \n  t3<-1 else t3<-0\n  if (tad>=90 & tad<100) \n  t4<-1 else t4<-0\n  if (tad>=100) \n  t5<-1 else t5<-0}\n\n  if (tas>=120 & tas<130){\n  if (tad<85) \n  t2<-1 else t2<-0\n  if (tad>=85 & tad<90) \n  t3<-1 else t3<-0\n  if (tad>=90 & tad<100) \n  t4<-1 else t4<-0\n  if (tad>=100) \n  t5<-1 else t5<-0}\n\n  if (tas>=130 & tas<140){\n  if (tad<90) \n  t3<-1 else t3<-0\n  if (tad>=90 & tad<100) \n  t4<-1 else t4<-0\n  if (tad>=100) \n  t5<-1 else t5<-0}\n\n  if (tas>=140 & tas<160){\n  if (tad<100) \n  t4<-1 else t4<-0\n  if (tad>=100) \n  t5<-1 else t5<-0}\n\n  if (tas>=160){t5<-1}\n\n  if (sexo==0){\n\tl=0.04826*edad-0.65945*col1+0*col2+0.17692*col3+0.50539*col4+0.65713*col5+0.49744*hdl1+0.24310*hdl2+0*hdl3-0.05107*hdl4-0.48660*hdl5-0.00226*t1+0*t2+0.28320*t3+0.52168*t4+0.61859*t5+0.42839*diabetes+0.52337*fuma\n  }\n  if (sexo==1){\n\tl=0.33766*edad-0.00268*(edad^2)-0.26138*col1+0*col2+0.20771*col3+0.24385*col4+0.53513*col5+0.84312*hdl1+0.37796*hdl2+0.19785*hdl3+0*hdl4-0.42951*hdl5-0.053363*t1+0*t2-0.06773*t3+0.26288*t4+0.46573*t5+0.59626*diabetes+0.29246*fuma\n  }\n\n  if (sexo==0){g=2.5679}\n  if (sexo==1){g=9.2912}\n\n  dif=l-g\n  exponencial=exp(dif)\n\n  if (sexo==0){superv10=0.945}\n  if (sexo==1){superv10=0.979}\n\n  h0=-log(superv10)\n  exponente=h0*exponencial\n\n  p=1-exp((-1)*exponente)\n\n  if (edad>=25 && edad<=64) resultados[registro]=p else resultados[registro]=NA\n}\n\nmatriz_final=data.frame(coloca_reg,resultados)\nmatriz_final2=na.omit(matriz_final)\n\nposicion=dim(misdatos.full)[1]\nlista_pos=data.frame(rep(1:posicion))\n\nmatriz_final3=merge(lista_pos,matriz_final2,by.x=\"rep.1.posicion.\",by.y=\"row.names.misdatos.\",all=\"TRUE\")\n\nwb.result=loadWorkbook(file.import, create=FALSE)\nappendWorksheet(wb.result,matriz_final3,sheet=2,header=TRUE,rownames=FALSE)\nsaveWorkbook(wb.result,file.import)\n\ngmessage(\"End of Process. Please, open de Excel file to view the results.\", title=\"OK\")\n}\n\n\nframingham_c=function()\n{\n###########################################################################\n## CLASSIC FRAMINGHAM - Programmed, no tables.\n## Ref: \"An updated coronary risk profile. A statement for helth \n## professionals\"\n## KM Anderson, PW Wilson, PM Odell and WB Kannel\n## Circulation 1991;83;356-362\n###########################################################################\n\nfile.import=gfile(\"Please, Select the Excel file with the DATA to import...\",filter=\"*.*\")\nwb.datos=loadWorkbook(file.import, create=FALSE)\nmisdatos.full=readWorksheet(wb.datos, sheet=1)\nmisdatos=na.omit(misdatos.full)\ncoloca_reg=data.frame(row.names(misdatos))\nnum_regs=dim(misdatos)[1]\nresultados=0\nregistro=1\n\nfor (registro in 1:num_regs)\n{\n  sexo=misdatos[registro,1]\n  edad=misdatos[registro,2]\n  colesterol=misdatos[registro,3]\n  hdl=misdatos[registro,4]\n  tas=misdatos[registro,5]\n  tad=misdatos[registro,6]\n  fuma=misdatos[registro,7]\n  diabetes=misdatos[registro,8]\n  hipertrofia=misdatos[registro,9]\n\n  a<-11.1122-0.9119*log(tas)-0.2767*(fuma)-0.7181*log(colesterol/hdl)-0.5865*(hipertrofia)\n\n  if (sexo==0){\n\tm=a-1.4792*log(edad)-0.1759*(diabetes)}\n\n  if (sexo==1){\n\tm=a-5.8549+1.8515*(log(edad/74))^2-0.3758*(diabetes)}\n\n  mu<-4.4181+m\n  sigma=exp(-0.3155-0.2784*m)\n  u<-(log(10)-mu)/sigma\n  p=1-exp(-exp(u))\n  # resultados[registro]=p\n  if (edad>=30 && edad<=74) resultados[registro]=p else resultados[registro]=NA\n}\n\nmatriz_final=data.frame(coloca_reg,resultados)\nmatriz_final2=na.omit(matriz_final)\n\nposicion=dim(misdatos.full)[1]\nlista_pos=data.frame(rep(1:posicion))\n\nmatriz_final3=merge(lista_pos,matriz_final2,by.x=\"rep.1.posicion.\",by.y=\"row.names.misdatos.\",all=\"TRUE\")\n\nwb.result=loadWorkbook(file.import, create=FALSE)\nappendWorksheet(wb.result,matriz_final3,sheet=2,header=TRUE,rownames=FALSE)\nsaveWorkbook(wb.result,file.import)\n\ngmessage(\"End of Process. Please, open de Excel file to view the results.\", title=\"OK\")\n}\n\n\nframingham_w=function()\n{\n###########################################################################\n## FRAMINGHAM-WILSON  \n## CATEGORIZED FRAMINGHAM (COLESTEROL) - Programmed, no tables.\n## ref: Wilson Peter WF, D'Agostino R, Levy D, Belanger A, Silbershatz H,\n## Kannel W\n## Prediction of Coronary Heart Disease Using Risk Factor categories.\n## Circulation 1998; 97: 1837-47.\n###########################################################################\n\nfile.import=gfile(\"Please, Select the Excel file with the DATA to import...\",filter=\"*.*\")\nwb.datos=loadWorkbook(file.import, create=FALSE)\nmisdatos.full=readWorksheet(wb.datos, sheet=1)\nmisdatos=na.omit(misdatos.full)\ncoloca_reg=data.frame(row.names(misdatos))\nnum_regs=dim(misdatos)[1]\nresultados=0\nregistro=1\n\nfor (registro in 1:num_regs)\n{\n  sexo=misdatos[registro,1]\n  edad=misdatos[registro,2]\n  colesterol=misdatos[registro,3]\n  hdl=misdatos[registro,4]\n  tas=misdatos[registro,5]\n  tad=misdatos[registro,6]\n  fuma=misdatos[registro,7]\n  diabetes=misdatos[registro,8]\n  hipertrofia=misdatos[registro,9]\n  \n  if (colesterol<160)col1<-1 else col1<-0\n  if (colesterol>=160 & colesterol<200)col2<-1 else col2<-0 \n  if (colesterol>=200 & colesterol<240)col3<-1 else col3<-0 \n  if (colesterol>=240 & colesterol<280)col4<-1 else col4<-0 \n  if (colesterol>=280)col5<-1 else col5<-0 \n\n  if (hdl<35)hdl1<-1 else hdl1<-0\n  if (hdl>=35 & hdl<45)hdl2<-1 else hdl2<-0 \n  if (hdl>=45 & hdl<50)hdl3<-1 else hdl3<-0 \n  if (hdl>=50 & hdl<60)hdl4<-1 else hdl4<-0 \n  if (hdl>=60)hdl5<-1 else hdl5<-0 \n\n  t1<-0\n  t2<-0\n  t3<-0\n  t4<-0\n  t5<-0\n\n  if (tas<120  & tad<80)t1<-1 else t1<-0\n\n  if (tas<120){\n  if (tad>=80 & tad<85) \n  t2<-1 else t2<-0\n  if (tad>=85 & tad<90) \n  t3<-1 else t3<-0\n  if (tad>=90 & tad<100) \n  t4<-1 else t4<-0\n  if (tad>=100) \n  t5<-1 else t5<-0}\n\n  if (tas>=120 & tas<130){\n  if (tad<85) \n  t2<-1 else t2<-0\n  if (tad>=85 & tad<90) \n  t3<-1 else t3<-0\n  if (tad>=90 & tad<100) \n  t4<-1 else t4<-0\n  if (tad>=100) \n  t5<-1 else t5<-0}\n\n  if (tas>=130 & tas<140){\n  if (tad<90) \n  t3<-1 else t3<-0\n  if (tad>=90 & tad<100) \n  t4<-1 else t4<-0\n  if (tad>=100) \n  t5<-1 else t5<-0}\n\n  if (tas>=140 & tas<160){\n  if (tad<100) \n  t4<-1 else t4<-0\n  if (tad>=100) \n  t5<-1 else t5<-0}\n\n  if (tas>=160){t5<-1}\n\n  if (sexo==0){\n\tl=0.04826*edad-0.65945*col1+0*col2+0.17692*col3+0.50539*col4+0.65713*col5+0.49744*hdl1+0.24310*hdl2+0*hdl3-0.05107*hdl4-0.48660*hdl5-0.00226*t1+0*t2+0.28320*t3+0.52168*t4+0.61859*t5+0.42839*diabetes+0.52337*fuma\n  }\n  if (sexo==1){\n\tl=0.33766*edad-0.00268*(edad^2)-0.26138*col1+0*col2+0.20771*col3+0.24385*col4+0.53513*col5+0.84312*hdl1+0.37796*hdl2+0.19785*hdl3+0*hdl4-0.42951*hdl5-0.53363*t1+0*t2-0.06773*t3+0.26288*t4+0.46573*t5+0.59626*diabetes+0.29246*fuma\n  }\n\n  if (sexo==0){g=3.0919}\n  if (sexo==1){g=9.8877}\n\n  dif=l-g\n  exponencial=exp(dif)\n\n  if (sexo==0){superv10=0.90015}\n  if (sexo==1){superv10=0.96246}\n\n  supervivencia=superv10^exponencial\n  p=1-supervivencia\n\n  if (edad>=30 && edad<=74) resultados[registro]=p else resultados[registro]=NA\n}\n\nmatriz_final=data.frame(coloca_reg,resultados)\nmatriz_final2=na.omit(matriz_final)\nposicion=dim(misdatos.full)[1]\nlista_pos=data.frame(rep(1:posicion))\nmatriz_final3=merge(lista_pos,matriz_final2,by.x=\"rep.1.posicion.\",by.y=\"row.names.misdatos.\",all=\"TRUE\")\nwb.result=loadWorkbook(file.import, create=FALSE)\nappendWorksheet(wb.result,matriz_final3,sheet=2,header=TRUE,rownames=FALSE)\nsaveWorkbook(wb.result,file.import)\n\ngmessage(\"End of Process. Please, open de Excel file to view the results.\", title=\"OK\")\n}\n\n\nregicor=function()\n{\n###########################################################################\n## REGICOR (FRAMINGHAM, SPAIN CALIBRATED). Programmed, no tables\n##\tref: Marrugat J, Solanas P, D'Agostino R, et al.\n##\tCoronary risk estimation in Spain using a calibrated Framingham \n## function.\n##\tRev Esp Cardiol. 2003 Mar;56(3):253-61. Spanish. PubMed PMID: 12622955\n###########################################################################\n\nfile.import=gfile(\"Please, Select the Excel file with the DATA to import...\",filter=\"*.*\")\nwb.datos=loadWorkbook(file.import, create=FALSE)\nmisdatos.full=readWorksheet(wb.datos, sheet=1)\nmisdatos=na.omit(misdatos.full)\ncoloca_reg=data.frame(row.names(misdatos))\nnum_regs=dim(misdatos)[1]\nresultados=0\nregistro=1\n\nfor (registro in 1:num_regs)\n{\n  sexo=misdatos[registro,1]\n  edad=misdatos[registro,2]\n  colesterol=misdatos[registro,3]\n  hdl=misdatos[registro,4]\n  tas=misdatos[registro,5]\n  tad=misdatos[registro,6]\n  fuma=misdatos[registro,7]\n  diabetes=misdatos[registro,8]\n  hipertrofia=misdatos[registro,9]\n  \n  if (colesterol<160)col1<-1 else col1<-0\n  if (colesterol>=160 & colesterol<200)col2<-1 else col2<-0 \n  if (colesterol>=200& colesterol<240)col3<-1 else col3<-0 \n  if (colesterol>=240 & colesterol<280)col4<-1 else col4<-0 \n  if (colesterol>=280)col5<-1 else col5<-0 \n\n  if (hdl<35)hdl1<-1 else hdl1<-0\n  if (hdl>=35 & hdl<45)hdl2<-1 else hdl2<-0 \n  if (hdl>=45 & hdl<50)hdl3<-1 else hdl3<-0 \n  if (hdl>=50 & hdl<60)hdl4<-1 else hdl4<-0 \n  if (hdl>=60)hdl5<-1 else hdl5<-0 \n\n  t1<-0\n  t2<-0\n  t3<-0\n  t4<-0\n  t5<-0\n\n  if (tas<120  & tad<80)t1<-1 else t1<-0\n\n  if (tas<120){\n  if (tad>=80 & tad<85) \n  t2<-1 else t2<-0\n  if (tad>=85 & tad<90) \n  t3<-1 else t3<-0\n  if (tad>=90 & tad<100) \n  t4<-1 else t4<-0\n  if (tad>=100) \n  t5<-1 else t5<-0}\n\n  if (tas>=120 & tas<130){\n  if (tad<85) \n  t2<-1 else t2<-0\n  if (tad>=85 & tad<90) \n  t3<-1 else t3<-0\n  if (tad>=90 & tad<100) \n  t4<-1 else t4<-0\n  if (tad>=100) \n  t5<-1 else t5<-0}\n\n  if (tas>=130 & tas<140){\n  if (tad<90) \n  t3<-1 else t3<-0\n  if (tad>=90 & tad<100) \n  t4<-1 else t4<-0\n  if (tad>=100) \n  t5<-1 else t5<-0}\n\n  if (tas>=140 & tas<160){\n  if (tad<100) \n  t4<-1 else t4<-0\n  if (tad>=100) \n  t5<-1 else t5<-0}\n\n  if (tas>=160){t5<-1}\n\n  if (sexo==0){\n\tl=0.04826*edad-0.65945*col1+0*col2+0.17692*col3+0.50539*col4+0.65713*col5+0.49744*hdl1+0.24310*hdl2+0*hdl3-0.05107*hdl4-0.48660*hdl5-0.00226*t1+0*t2+0.28320*t3+0.52168*t4+0.61859*t5+0.42839*diabetes+0.52337*fuma\n  }\n  if (sexo==1){\n\tl=0.33766*edad-0.00268*(edad^2)-0.26138*col1+0*col2+0.20771*col3+0.24385*col4+0.53513*col5+0.84312*hdl1+0.37796*hdl2+0.19785*hdl3+0*hdl4-0.42951*hdl5-0.53363*t1+0*t2-0.06773*t3+0.26288*t4+0.46573*t5+0.59626*diabetes+0.29246*fuma\n  }\n\n  if (sexo==0){g=3.4881}\n  if (sexo==1){g=10.2973}\n\n  dif=l-g\n  exponencial=exp(dif)\n\n  if (sexo==0){superv10=0.9510}\n  if (sexo==1){superv10=0.9780}\n\n  h0=-log(superv10)\n  exponente=h0*exponencial\n  p=1-exp((-1)*exponente)\n\n  if (edad>=35 && edad<=74) resultados[registro]=p else resultados[registro]=NA\n}\n\nmatriz_final=data.frame(coloca_reg,resultados)\nmatriz_final2=na.omit(matriz_final)\nposicion=dim(misdatos.full)[1]\nlista_pos=data.frame(rep(1:posicion))\nmatriz_final3=merge(lista_pos,matriz_final2,by.x=\"rep.1.posicion.\",by.y=\"row.names.misdatos.\",all=\"TRUE\")\nwb.result=loadWorkbook(file.import, create=FALSE)\nappendWorksheet(wb.result,matriz_final3,sheet=2,header=TRUE,rownames=FALSE)\nsaveWorkbook(wb.result,file.import)\n\ngmessage(\"End of Process. Please, open de Excel file to view the results.\", title=\"OK\")\n}\n\n\nhrs=function()\n{\n###########################################################################\n## PROYECTO SCORE (RIESGO ALTO)\n## ref: Conroy RM, Py?r?l? K, Fitzgerald AP, Sans S, Menotti A, De Backer \n## G, De Bacquer D, Ducimeti?re P, Jousilahti P, Keil U, Nj?lstad I, Oganov \n## RG, Thomsen T, Tunstall-Pedoe H, Tverdal A, Wedel H, Whincup P, \n## Wilhelmsen L, Graham IM; SCORE\tproject group.\n## Estimation of ten-year risk of fatal cardiovascular disease in Europe:\n## the SCORE project. Eur Heart J. 2003 Jun;24(11):987-1003. \n## PubMed PMID:12788299.\n###########################################################################\n\nfile.import=gfile(\"Please, Select the Excel file with the DATA to import...\",filter=\"*.*\")\nwb.datos=loadWorkbook(file.import, create=FALSE)\nmisdatos.full=readWorksheet(wb.datos, sheet=1)\nmisdatos=na.omit(misdatos.full)\ncoloca_reg=data.frame(row.names(misdatos))\nnum_regs=dim(misdatos)[1]\nresultados=0\nregistro=1\n\nfor (registro in 1:num_regs)\n{\n  sexo=misdatos[registro,1]\n  edad=misdatos[registro,2]\n  colesterol=misdatos[registro,3]\n  hdl=misdatos[registro,4]\n  tas=misdatos[registro,5]\n  tad=misdatos[registro,6]\n  fuma=misdatos[registro,7]\n  diabetes=misdatos[registro,8]\n  hipertrofia=misdatos[registro,9]\n\n  s0_edad<-0\n  s0_edad10<-0\n\n  if (sexo==0){\n  s0_edad=exp(-exp(-21.0)*(edad-20)^4.62)\n\ts0_edad10=exp(-exp(-21.0)*(edad-10)^4.62)}\n  s0_edad\n  s0_edad10\n\n  if (sexo==1){\n\ts0_edad=exp(-exp(-28.7)*(edad-20)^6.23)\n\ts0_edad10=exp(-exp(-28.7)*(edad-10)^6.23)}\n  s0_edad\n  s0_edad10\n\n  w<-0\n  w=0.24*(0.02586*colesterol-6)+0.018*(tas-120)+0.71*(fuma)\n  \n  s_edad<-0\n  s_edad10<-0\n\n  s_edad=s0_edad^exp(w)\n  s_edad\n  s_edad10=s0_edad10^exp(w)\n  s_edad10\n\n  s10_edad=s_edad10/s_edad\n  s10_edad\n\n  riesgo10_ec=1-s10_edad\n  riesgo10_ec\n\n  s0_edad<-0\n  s0_edad10<-0\n\n  if (sexo==0){\n\ts0_edad=exp(-exp(-25.7)*(edad-20)^5.47)\n\ts0_edad10=exp(-exp(-25.7)*(edad-10)^5.47)}\n  s0_edad\n  s0_edad10\n\n  if (sexo==1){\n\ts0_edad=exp(-exp(-30.0)*(edad-20)^6.42)\n\ts0_edad10=exp(-exp(-30.0)*(edad-10)^6.42)}\n  s0_edad\n  s0_edad10\n\n  w<-0\n  w=0.02*(0.02586*colesterol-6)+0.022*(tas-120)+0.63*(fuma)\n\n  s_edad<-0\n  s_edad10<-0\n\n  s_edad=s0_edad^exp(w)\n  s_edad\n  s_edad10=s0_edad10^exp(w)\n  s_edad10\n\n  s10_edad=s_edad10/s_edad\n  s10_edad\n\n    riesgo10_enc=1-s10_edad\n  riesgo10_enc\n\n  p=(riesgo10_ec+riesgo10_enc)\n  p\n\n  if (edad>=35 && edad<=64) resultados[registro]=p else resultados[registro]=NA\n}\n\nmatriz_final=data.frame(coloca_reg,resultados)\nmatriz_final2=na.omit(matriz_final)\n\nposicion=dim(misdatos.full)[1]\nlista_pos=data.frame(rep(1:posicion))\n\nmatriz_final3=merge(lista_pos,matriz_final2,by.x=\"rep.1.posicion.\",by.y=\"row.names.misdatos.\",all=\"TRUE\")\n\nwb.result=loadWorkbook(file.import, create=FALSE)\nappendWorksheet(wb.result,matriz_final3,sheet=2,header=TRUE,rownames=FALSE)\nsaveWorkbook(wb.result,file.import)\n\ngmessage(\"End of Process. Please, open de Excel file to view the results.\", title=\"OK\")\n}\n### HRS'S END ###\n\n### LOW RISK SCORE ###\nlrs=function()\n{\n###########################################################################\n## PROYECTO SCORE (RIESGO BAJO)\n## ref: Conroy RM, Py?r?l? K, Fitzgerald AP, Sans S, Menotti A, De Backer\n## G, De Bacquer D, Ducimeti?re P, Jousilahti P, Keil U, Nj?lstad I, Oganov\n## RG, Thomsen T, Tunstall-Pedoe H, Tverdal A, Wedel H, Whincup P, \n## Wilhelmsen L, Graham IM; SCORE\tproject group.\n## Estimation of ten-year risk of fatal cardiovascular disease in Europe: \n## the SCORE project. Eur Heart J. 2003 Jun;24(11):987-1003. \n## PubMed PMID:12788299.\n###########################################################################\n\nfile.import=gfile(\"Please, Select the Excel file with the DATA to import...\",filter=\"*.*\")\nwb.datos=loadWorkbook(file.import, create=FALSE)\nmisdatos.full=readWorksheet(wb.datos, sheet=1)\nmisdatos=na.omit(misdatos.full)\ncoloca_reg=data.frame(row.names(misdatos))\nnum_regs=dim(misdatos)[1]\nresultados=0\nregistro=1\n\nfor (registro in 1:num_regs)\n{\n  sexo=misdatos[registro,1]\n  edad=misdatos[registro,2]\n  colesterol=misdatos[registro,3]\n  hdl=misdatos[registro,4]\n  tas=misdatos[registro,5]\n  tad=misdatos[registro,6]\n  fuma=misdatos[registro,7]\n  diabetes=misdatos[registro,8]\n  hipertrofia=misdatos[registro,9]\n\n  s0_edad<-0\n  s0_edad10<-0\n\n  if (sexo==0){\n\ts0_edad=exp(-exp(-22.1)*(edad-20)^4.71)\n\ts0_edad10=exp(-exp(-22.1)*(edad-10)^4.71)}\n  s0_edad\n  s0_edad10\n\n  if (sexo==1){\n\ts0_edad=exp(-exp(-29.8)*(edad-20)^6.36)\n\ts0_edad10=exp(-exp(-29.8)*(edad-10)^6.36)}\n  s0_edad\n  s0_edad10\n\n  w<-0\n  w=0.24*(0.02586*colesterol-6)+0.018*(tas-120)+0.71*(fuma)\n\n  s_edad<-0\n  s_edad10<-0\n\n  s_edad=s0_edad^exp(w)\n  s_edad\n  s_edad10=s0_edad10^exp(w)\n  s_edad10\n\n  s10_edad=s_edad10/s_edad\n  s10_edad\n\n  riesgo10_ec=1-s10_edad\n  riesgo10_ec\n\n  s0_edad<-0\n  s0_edad10<-0\n\n  if (sexo==0){\n\ts0_edad=exp(-exp(-26.7)*(edad-20)^5.64)\n\ts0_edad10=exp(-exp(-26.7)*(edad-10)^5.64)}\n  s0_edad\n  s0_edad10\n\n  if (sexo==1){\n\ts0_edad=exp(-exp(-31.0)*(edad-20)^6.62)\n\ts0_edad10=exp(-exp(-31.0)*(edad-10)^6.62)}\n  s0_edad\n  s0_edad10\n\n  w<-0\n  w=0.02*(0.02586*colesterol-6)+0.022*(tas-120)+0.63*(fuma)\n\n  s_edad<-0\n  s_edad10<-0\n\n  s_edad=s0_edad^exp(w)\n  s_edad\n  s_edad10=s0_edad10^exp(w)\n  s_edad10\n\n  s10_edad=s_edad10/s_edad\n  s10_edad\n\n  riesgo10_enc=1-s10_edad\n  riesgo10_enc\n\n  p=(riesgo10_ec+riesgo10_enc)\n  p\n\n  if (edad>=35 && edad<=64) resultados[registro]=p else resultados[registro]=NA\n}\n\nmatriz_final=data.frame(coloca_reg,resultados)\nmatriz_final2=na.omit(matriz_final)\nposicion=dim(misdatos.full)[1]\nlista_pos=data.frame(rep(1:posicion))\nmatriz_final3=merge(lista_pos,matriz_final2,by.x=\"rep.1.posicion.\",by.y=\"row.names.misdatos.\",all=\"TRUE\")\nwb.result=loadWorkbook(file.import, create=FALSE)\nappendWorksheet(wb.result,matriz_final3,sheet=2,header=TRUE,rownames=FALSE)\nsaveWorkbook(wb.result,file.import)\n\ngmessage(\"End of Process. Please, open de Excel file to view the results.\", title=\"OK\")\n}\n### LRS'S END ###\n\n\n\n\n\n\n\n",
    "created" : 1375948109491.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "705795134",
    "id" : "9C85C3B0",
    "lastKnownWriteTime" : 1375951200,
    "path" : "C:/Users/mrodmui/Dropbox/Programacion_SCORES/cvrcalc/R/cvrcalc.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}